{% comment %}
  Countdown Timer Widget
  Displays a countdown timer for urgency and FOMO
{% endcomment %}

<div class="ab-optimizer-countdown" 
     style="
       padding: {{ block.settings.padding }}px;
       background: {{ block.settings.background_color }};
       border-radius: {{ block.settings.border_radius }}px;
       border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
       margin: {{ block.settings.margin }}px 0;
       text-align: center;
     ">

  <div class="countdown-header" style="color: {{ block.settings.text_color }}; margin-bottom: 12px;">
    <span style="font-size: {{ block.settings.font_size }}px; font-weight: bold;">
      {{ block.settings.header_text | default: 'Limited Time Offer!' }}
    </span>
  </div>

  <div class="countdown-timer" 
       data-end-time="{{ block.settings.end_time }}"
       style="display: flex; justify-content: center; gap: 16px; margin-bottom: 12px;">
    
    <div class="time-unit" style="text-align: center;">
      <div class="time-value" style="
        font-size: {{ block.settings.timer_font_size }}px; 
        font-weight: bold; 
        color: {{ block.settings.timer_color }};
        background: {{ block.settings.timer_background }};
        padding: 8px 12px;
        border-radius: 6px;
        min-width: 50px;
        display: inline-block;
      " id="days">00</div>
      <div class="time-label" style="
        font-size: {{ block.settings.label_font_size }}px; 
        color: {{ block.settings.text_color }};
        margin-top: 4px;
      ">Days</div>
    </div>

    <div class="time-unit" style="text-align: center;">
      <div class="time-value" style="
        font-size: {{ block.settings.timer_font_size }}px; 
        font-weight: bold; 
        color: {{ block.settings.timer_color }};
        background: {{ block.settings.timer_background }};
        padding: 8px 12px;
        border-radius: 6px;
        min-width: 50px;
        display: inline-block;
      " id="hours">00</div>
      <div class="time-label" style="
        font-size: {{ block.settings.label_font_size }}px; 
        color: {{ block.settings.text_color }};
        margin-top: 4px;
      ">Hours</div>
    </div>

    <div class="time-unit" style="text-align: center;">
      <div class="time-value" style="
        font-size: {{ block.settings.timer_font_size }}px; 
        font-weight: bold; 
        color: {{ block.settings.timer_color }};
        background: {{ block.settings.timer_background }};
        padding: 8px 12px;
        border-radius: 6px;
        min-width: 50px;
        display: inline-block;
      " id="minutes">00</div>
      <div class="time-label" style="
        font-size: {{ block.settings.label_font_size }}px; 
        color: {{ block.settings.text_color }};
        margin-top: 4px;
      ">Minutes</div>
    </div>

    <div class="time-unit" style="text-align: center;">
      <div class="time-value" style="
        font-size: {{ block.settings.timer_font_size }}px; 
        font-weight: bold; 
        color: {{ block.settings.timer_color }};
        background: {{ block.settings.timer_background }};
        padding: 8px 12px;
        border-radius: 6px;
        min-width: 50px;
        display: inline-block;
      " id="seconds">00</div>
      <div class="time-label" style="
        font-size: {{ block.settings.label_font_size }}px; 
        color: {{ block.settings.text_color }};
        margin-top: 4px;
      ">Seconds</div>
    </div>
  </div>

  {% if block.settings.show_message %}
    <div class="countdown-message" style="color: {{ block.settings.text_color }};">
      <span style="font-size: {{ block.settings.font_size | minus: 2 }}px;">
        {{ block.settings.message_text | default: "Don't miss out on this amazing offer!" }}
      </span>
    </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const countdownElement = document.querySelector('.ab-optimizer-countdown');
  if (!countdownElement) return;

  const endTime = countdownElement.querySelector('.countdown-timer').dataset.endTime;
  if (!endTime) return;

  const endDate = new Date(endTime);
  
  function updateCountdown() {
    const now = new Date();
    const timeLeft = endDate - now;
    
    if (timeLeft <= 0) {
      countdownElement.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;"><strong>Offer Expired!</strong></div>';
      return;
    }
    
    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    const daysElement = countdownElement.querySelector('#days');
    const hoursElement = countdownElement.querySelector('#hours');
    const minutesElement = countdownElement.querySelector('#minutes');
    const secondsElement = countdownElement.querySelector('#seconds');
    
    if (daysElement) daysElement.textContent = days.toString().padStart(2, '0');
    if (hoursElement) hoursElement.textContent = hours.toString().padStart(2, '0');
    if (minutesElement) minutesElement.textContent = minutes.toString().padStart(2, '0');
    if (secondsElement) secondsElement.textContent = seconds.toString().padStart(2, '0');
  }
  
  updateCountdown();
  setInterval(updateCountdown, 1000);
});
</script>

{% schema %}
{
  "name": "Countdown Timer",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "header_text",
      "label": "Header Text",
      "default": "Limited Time Offer!"
    },
    {
      "type": "text",
      "id": "end_time",
      "label": "End Date & Time",
      "default": "2024-12-31T23:59:59",
      "info": "Format: YYYY-MM-DDTHH:MM:SS"
    },
    {
      "type": "checkbox",
      "id": "show_message",
      "label": "Show Message",
      "default": true
    },
    {
      "type": "text",
      "id": "message_text",
      "label": "Message Text",
      "default": "Don't miss out on this amazing offer!"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "timer_color",
      "label": "Timer Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "timer_background",
      "label": "Timer Background Color",
      "default": "#32cd32"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#32cd32"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border Width",
      "min": 0,
      "max": 5,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 8
    },
    {
      "type": "range",
      "id": "padding",
      "label": "Padding",
      "min": 8,
      "max": 32,
      "step": 1,
      "default": 20
    },
    {
      "type": "range",
      "id": "margin",
      "label": "Margin",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 8
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font Size",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16
    },
    {
      "type": "range",
      "id": "timer_font_size",
      "label": "Timer Font Size",
      "min": 16,
      "max": 32,
      "step": 1,
      "default": 20
    },
    {
      "type": "range",
      "id": "label_font_size",
      "label": "Label Font Size",
      "min": 10,
      "max": 18,
      "step": 1,
      "default": 12
    }
  ]
}
{% endschema %} 