{% comment %}
{
  "name": "Live Visitor Count",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "visitor_text",
      "label": "Visitor Text",
      "default": "People viewing this page"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "number_color",
      "label": "Number Color",
      "default": "#1e3a8a"
    }
  ]
}
{% endcomment %}

<div class="live-visitor-widget" data-widget-id="visitor-{{ block.id }}">
  <span class="visitor-count" data-count="76">76</span>
  <span class="visitor-text">{{ block.settings.visitor_text | default: "People viewing this page" }}</span>
</div>

<style>
.live-visitor-widget {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 12px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 25px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 14px;
  border: none;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  position: relative;
  overflow: hidden;
  animation: gradientShift 3s ease-in-out infinite;
}

.live-visitor-widget::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  animation: shimmer 2s infinite;
}

.visitor-count {
  font-weight: 700;
  color: white;
  min-width: 24px;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  z-index: 1;
  position: relative;
}

.visitor-text {
  color: white;
  font-weight: 500;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  z-index: 1;
  position: relative;
}

@keyframes gradientShift {
  0% {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  25% {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }
  50% {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }
  75% {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  }
  100% {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

@keyframes pulse {
  0%, 100% { 
    opacity: 1;
    transform: scale(1);
  }
  50% { 
    opacity: 0.8;
    transform: scale(1.05);
  }
}

.visitor-count.updating {
  animation: pulse 0.6s ease-in-out;
}

.live-visitor-widget:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  transition: all 0.3s ease;
}

.live-visitor-widget:hover::before {
  animation-duration: 1s;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const widget = document.querySelector('[data-widget-id="visitor-{{ block.id }}"]');
  const countElement = widget.querySelector('.visitor-count');
  
  if (!widget || !countElement) return;
  
  let currentCount = parseInt(countElement.dataset.count) || 76;
  
  // Simulate live visitor tracking
  function updateVisitorCount() {
    // Generate realistic visitor count changes
    const change = Math.random() > 0.5 ? 
      Math.floor(Math.random() * 3) + 1 : // +1 to +3
      -(Math.floor(Math.random() * 2) + 1); // -1 to -2
    
    const newCount = Math.max(1, currentCount + change);
    
    if (newCount !== currentCount) {
      countElement.classList.add('updating');
      currentCount = newCount;
      
      setTimeout(() => {
        countElement.textContent = currentCount;
        countElement.dataset.count = currentCount;
        countElement.classList.remove('updating');
      }, 300);
    }
  }
  
  // Update every 8-15 seconds
  function scheduleNextUpdate() {
    const delay = Math.random() * 7000 + 8000; // 8-15 seconds
    setTimeout(() => {
      updateVisitorCount();
      scheduleNextUpdate();
    }, delay);
  }
  
  // Start the live updates
  scheduleNextUpdate();
  
  // Real visitor tracking (placeholder for actual implementation)
  function trackRealVisitors() {
    // This would integrate with your analytics or real-time visitor tracking
    // For now, we'll use the simulated updates above
    
    // Example of how to integrate with real data:
    // fetch('/api/visitor-count')
    //   .then(response => response.json())
    //   .then(data => {
    //     if (data.count !== currentCount) {
    //       updateCount(data.count);
    //     }
    //   });
  }
});
</script>

{% schema %}
{
  "name": "Live Visitor Count",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "visitor_text",
      "label": "Visitor Text",
      "default": "People viewing this page"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "number_color",
      "label": "Number Color",
      "default": "#1e3a8a"
    }
  ]
}
{% endschema %}
