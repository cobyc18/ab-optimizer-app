{%- comment -%}
  Simple Text Badge Widget Block
  Displays a promotional badge with icon, text, and customizable colors
  
  Visibility Logic:
  - Always visible in theme editor (request.design_mode)
  - On live storefront, only visible if A/B test is running (product.metafields.ab_optimizer.test_running)
{%- endcomment -%}

{%- comment -%} Check if block should be visible: always in theme editor, or if test is running on live storefront {%- endcomment -%}
{%- assign is_visible = false -%}
{%- if request.design_mode -%}
  {%- assign is_visible = true -%}
{%- elsif product.metafields.ab_optimizer.test_running == true -%}
  {%- assign is_visible = true -%}
{%- endif -%}

{%- comment -%} Always render the widget container, but hide it if not visible (for preview functionality) {%- endcomment -%}
<div class="simple-text-badge-widget{% unless is_visible %} trylab-hidden-by-default{% endunless %}" 
     {{ block.shopify_attributes }}
     data-badge-id="badge-{{ block.id }}"
     data-block-id="{{ block.id }}"
    data-enable-step-2="{{ block.settings.enable_step_2 | default: false }}"
    data-header-text="{{ block.settings.header_text | escape }}"
    data-body-text="{{ block.settings.body_text | escape }}"
    data-header-font="{{ block.settings.header_font | default: 'system' }}"
    data-header-font-size="{{ block.settings.header_font_size | default: 24 }}"
    data-header-underline="{{ block.settings.header_underline | default: false }}"
    data-body-font="{{ block.settings.body_font | default: 'system' }}"
    data-body-font-size="{{ block.settings.body_font_size | default: 16 }}"
    data-body-underline="{{ block.settings.body_underline | default: false }}"
    data-header-body-spacing="{{ block.settings.header_body_spacing | default: 6 }}"
    data-icon-text-spacing="{{ block.settings.icon_text_spacing | default: 20 }}"
    data-text-color="{{ block.settings.text_color | default: '#1a5f5f' }}"
     data-header-color="{{ block.settings.header_color | default: '#0f172a' }}"
     data-background-color="{{ block.settings.background_color | default: '#f5f5f0' }}"
     data-border-color="{{ block.settings.border_color | default: '#d4d4d8' }}"
     data-inner-padding-x="{{ block.settings.inner_padding_horizontal | default: 24 }}"
     data-inner-padding-y="{{ block.settings.inner_padding_vertical | default: 16 }}"
     data-inner-padding-x-mobile="{{ block.settings.inner_padding_horizontal_mobile | default: 16 }}"
     data-inner-padding-y-mobile="{{ block.settings.inner_padding_vertical_mobile | default: 12 }}"
     data-outer-padding-x="{{ block.settings.outer_padding_horizontal | default: 0 }}"
     data-outer-padding-y="{{ block.settings.outer_padding_vertical | default: 0 }}"
     data-outer-padding-x-mobile="{{ block.settings.outer_padding_horizontal_mobile | default: 0 }}"
     data-outer-padding-y-mobile="{{ block.settings.outer_padding_vertical_mobile | default: 0 }}"
     data-icon-choice="{{ block.settings.icon_choice | default: 'none' }}"
    data-icon-blink="{{ block.settings.icon_blink | default: false }}"
    data-icon-blink-intensity="{{ block.settings.icon_blink_intensity | default: 50 }}"
     data-icon-size="{{ block.settings.icon_size | default: 36 }}"
     data-icon-size-mobile="{{ block.settings.icon_size_mobile | default: 30 }}"
     data-border-radius="{{ block.settings.border_radius | default: 8 }}"
     data-border-thickness="{{ block.settings.border_thickness | default: 1 }}"
     data-hover-effect="{{ block.settings.hover_effect | default: false }}"
     data-drop-shadow="{{ block.settings.drop_shadow | default: 10 }}"
     {% if block.settings.icon_choice == 'none' %}
     data-icon-url=""
     data-icon-alt=""
     data-icon-custom="false"
     {% elsif block.settings.icon_custom %}
     data-icon-url="{{ block.settings.icon_custom | image_url: width: 120 }}"
     data-icon-alt="{{ block.settings.icon_custom.alt | default: 'Badge icon' }}"
     data-icon-custom="true"
     {% else %}
     data-icon-url="{{ 'default-app-block-settings.png' | asset_url }}"
     data-icon-alt="Badge icon"
     data-icon-custom="false"
     {% endif %}
     data-conversion-play-type="{{ block.settings.conversion_play_type | default: '' }}"
     data-count-min="{{ block.settings.count_min | default: 40 }}"
     data-count-max="{{ block.settings.count_max | default: 60 }}">
</div>

{% schema %}
{
  "name": "Simple Text Badge",
  "target": "section",
  "stylesheet": "simple-text-badge.css",
  "javascript": "simple-text-badge.js",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_step_2",
      "label": "Enable Step 2",
      "default": false,
      "info": "When enabled, changes text to 'Free Shipping', icon to trophy, and background to red"
    },
    {
      "type": "header",
      "content": "Text Content",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "richtext",
      "id": "header_text",
      "label": "Header text",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "select",
      "id": "header_font",
      "label": "Header font",
      "options": [
        { "value": "system", "label": "System default" },
        { "value": "poppins", "label": "Poppins" },
        { "value": "inter", "label": "Inter" },
        { "value": "roboto", "label": "Roboto" },
        { "value": "lato", "label": "Lato" },
        { "value": "montserrat", "label": "Montserrat" },
        { "value": "opensans", "label": "Open Sans" },
        { "value": "raleway", "label": "Raleway" },
        { "value": "playfair", "label": "Playfair Display" },
        { "value": "merriweather", "label": "Merriweather" },
        { "value": "sourcesans", "label": "Source Sans Pro" },
        { "value": "nunito", "label": "Nunito" },
        { "value": "worksans", "label": "Work Sans" },
        { "value": "ptsans", "label": "PT Sans" },
        { "value": "oswald", "label": "Oswald" },
        { "value": "notosans", "label": "Noto Sans" },
        { "value": "ubuntu", "label": "Ubuntu" },
        { "value": "georgia", "label": "Georgia" },
        { "value": "times", "label": "Times New Roman" },
        { "value": "arial", "label": "Arial" },
        { "value": "helvetica", "label": "Helvetica" },
        { "value": "courier", "label": "Courier New" },
        { "value": "verdana", "label": "Verdana" },
        { "value": "trebuchet", "label": "Trebuchet MS" }
      ],
      "default": "system",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "header_font_size",
      "label": "Header size (px)",
      "min": 12,
      "max": 64,
      "step": 1,
      "default": 24,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "checkbox",
      "id": "header_underline",
      "label": "Underline",
      "default": false,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "richtext",
      "id": "body_text",
      "label": "Body text",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "select",
      "id": "body_font",
      "label": "Body font",
      "options": [
        { "value": "system", "label": "System default" },
        { "value": "poppins", "label": "Poppins" },
        { "value": "inter", "label": "Inter" },
        { "value": "roboto", "label": "Roboto" },
        { "value": "lato", "label": "Lato" },
        { "value": "montserrat", "label": "Montserrat" },
        { "value": "opensans", "label": "Open Sans" },
        { "value": "raleway", "label": "Raleway" },
        { "value": "playfair", "label": "Playfair Display" },
        { "value": "merriweather", "label": "Merriweather" },
        { "value": "sourcesans", "label": "Source Sans Pro" },
        { "value": "nunito", "label": "Nunito" },
        { "value": "worksans", "label": "Work Sans" },
        { "value": "ptsans", "label": "PT Sans" },
        { "value": "oswald", "label": "Oswald" },
        { "value": "notosans", "label": "Noto Sans" },
        { "value": "ubuntu", "label": "Ubuntu" },
        { "value": "georgia", "label": "Georgia" },
        { "value": "times", "label": "Times New Roman" },
        { "value": "arial", "label": "Arial" },
        { "value": "helvetica", "label": "Helvetica" },
        { "value": "courier", "label": "Courier New" },
        { "value": "verdana", "label": "Verdana" },
        { "value": "trebuchet", "label": "Trebuchet MS" }
      ],
      "default": "system",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "body_font_size",
      "label": "Body size (px)",
      "min": 10,
      "max": 36,
      "step": 1,
      "default": 16,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "checkbox",
      "id": "body_underline",
      "label": "Underline",
      "default": false,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "header_body_spacing",
      "label": "Header to body spacing (px)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 6,
      "info": "Vertical space between header and body text",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "icon_text_spacing",
      "label": "Icon to text spacing (px)",
      "min": 0,
      "max": 60,
      "step": 2,
      "default": 20,
      "info": "Horizontal space between icon and text content",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "header",
      "content": "Padding",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "inner_padding_horizontal",
      "label": "Horizontal padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 24,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "inner_padding_vertical",
      "label": "Vertical padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 16,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "inner_padding_horizontal_mobile",
      "label": "Mobile horizontal padding (px)",
      "min": 0,
      "max": 80,
      "step": 1,
      "default": 16,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "inner_padding_vertical_mobile",
      "label": "Mobile vertical padding (px)",
      "min": 0,
      "max": 80,
      "step": 1,
      "default": 12,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "outer_padding_horizontal",
      "label": "Outer horizontal padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 0,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "outer_padding_vertical",
      "label": "Outer vertical padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 0,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "outer_padding_horizontal_mobile",
      "label": "Outer mobile horizontal padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 0,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "outer_padding_vertical_mobile",
      "label": "Outer mobile vertical padding (px)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 0,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "header",
      "content": "Icon",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "select",
      "id": "icon_choice",
      "label": "Icon selector",
      "options": [
        { "value": "none", "label": "None (no icon)", "group": "General" },
        { "value": "star", "label": "‚≠ê Star", "group": "Star Icons" },
        { "value": "trophy", "label": "üèÜ Trophy", "group": "Trophy Icons" },
        { "value": "gift", "label": "üéÅ Gift", "group": "Gift Icons" }
      ],
      "info": "Choose a built-in icon or select 'None' to remove. Upload a custom icon below to override.",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "image_picker",
      "id": "icon_custom",
      "label": "Upload custom icon",
      "info": "If uploaded, this icon will be used instead of the selected icon above",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "checkbox",
      "id": "icon_blink",
      "label": "Enable icon blink effect",
      "default": false,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "icon_blink_intensity",
      "label": "Blink intensity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 50,
      "info": "Lower = subtle, Higher = intense",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "icon_size",
      "label": "Icon size (px)",
      "min": 12,
      "max": 120,
      "step": 2,
      "default": 36,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "range",
      "id": "icon_size_mobile",
      "label": "Mobile icon size (px)",
      "min": 8,
      "max": 100,
      "step": 2,
      "default": 30,
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "header",
      "content": "Border and Colors",
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius (px)",
      "min": 0,
      "max": 60,
      "step": 1,
      "default": 8,
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "range",
      "id": "border_thickness",
      "label": "Border outline thickness (px)",
      "min": 0,
      "max": 12,
      "step": 1,
      "default": 1,
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "checkbox",
      "id": "hover_effect",
      "label": "Enable hover lift effect",
      "default": true,
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "range",
      "id": "drop_shadow",
      "label": "Drop shadow amount",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 10,
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "color",
      "id": "header_color",
      "label": "Header color",
      "default": "#0f172a",
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Body text color",
      "default": "#1a5f5f",
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f5f5f0",
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#d4d4d8",
      "visible_if": "{{ block.settings.enable_step_2 == true }}"
    },
    {
      "type": "text",
      "id": "conversion_play_type",
      "label": "Conversion Play Type",
      "info": "Internal setting to identify widget behavior type",
      "visible_if": "{{ block.settings.enable_step_2 == false }}"
    },
    {
      "type": "number",
      "id": "count_min",
      "label": "Minimum Count",
      "default": 40,
      "info": "Minimum number for how many in cart count (internal use)",
      "visible_if": "{{ block.settings.conversion_play_type == 'how-many-in-cart' and block.settings.enable_step_2 == false }}"
    },
    {
      "type": "number",
      "id": "count_max",
      "label": "Maximum Count",
      "default": 60,
      "info": "Maximum number for how many in cart count (internal use)",
      "visible_if": "{{ block.settings.conversion_play_type == 'how-many-in-cart' and block.settings.enable_step_2 == false }}"
    }
  ]
}
{% endschema %}

