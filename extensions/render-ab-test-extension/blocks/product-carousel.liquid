{%- comment -%}
  Product Carousel Widget Block
  Displays a carousel of products with navigation
{%- endcomment -%}

<div class="product-carousel-widget" 
     data-carousel-id="carousel-{{ block.id }}"
     data-block-id="{{ block.id }}"
     data-carousel-title="{{ block.settings.carousel_title | default: 'You may also like' }}"
     data-show-navigation="{{ block.settings.show_navigation | default: true }}"
     data-show-pagination="{{ block.settings.show_pagination | default: true }}">
  {%- if block.settings.products -%}
    <script type="application/json" data-products-json>
    [
      {%- for product in block.settings.products limit: 10 -%}
        {
          "id": {{ product.id | json }},
          "title": {{ product.title | json }},
          "handle": {{ product.handle | json }},
          "featured_image": {{ product.featured_image | img_url: '200x200' | json }},
          "price": {{ product.price | json }},
          "compare_at_price": {{ product.compare_at_price | json }},
          "variants": [
            {%- for variant in product.variants limit: 5 -%}
              {
                "id": {{ variant.id | json }},
                "title": {{ variant.title | json }},
                "price": {{ variant.price | json }},
                "compare_at_price": {{ variant.compare_at_price | json }},
                "available": {{ variant.available | json }}
              }{%- unless forloop.last -%},{%- endunless -%}
            {%- endfor -%}
          ]
        }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
    </script>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Product Carousel",
  "target": "section",
  "stylesheet": "product-carousel.css",
  "javascript": "product-carousel.js",
  "settings": [
    {
      "type": "text",
      "id": "carousel_title",
      "label": "Carousel Title",
      "default": "You may also like"
    },
    {
      "type": "product_list",
      "id": "products",
      "label": "Products to display",
      "limit": 10
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "Show pagination dots",
      "default": true
    }
  ]
}
{% endschema %}

